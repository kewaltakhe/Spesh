{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="profile">
    <div class="profile-container">
        <div class="profile">
            {% if user.profile_pic %}
                <img src="{{ user.profile_pic.url }}" alt="profilepic" class="profilepic">
            {% else %}
                <img src="{% static 'site_images/user.png' %}" alt="profilepic" class="profilepic">
            {% endif %}
            
        </div>
        <div class="username"><h1>{{ user.username }}</h1></div>
        <div class="user-id">@{{ user.username }}</div>
    
        <div class="user-bio">
            <div class="user-bio-text">
                {{ user.userbio }}
            </div>
        </div>
        <div class="followers-followings">
            <div class="followers" style="margin-right: 10px;" >
                Followers({{followers_count}})       
            </div>
            <div class="followings" style="margin-left: 30px;" >
                Followings({{followings_count}}) 
            </div>
        </div>
        <div class="upload-photo-icon-container">
            <a href="{% url 'upload_photo' %}"><img src="{% static 'icons/upload_photo.png' %}" class="upload-photo-icon"></a>
        </div>
        <div class="saved-uploaded">
            <div class="uploaded"><a href="#">uploaded ({{ photo_count }})</a></div>
            <div class="saved"><a href="#">saved</a></div>
        </div>
        
    <hr class="custom-hr">
        
    </div>
</div>

    
        {% if photo_count != 0 %}
        <div class="user-photos-container">
            {% for photo in user_photos %}
                    <img src="{{ photo.image.url }}" class="each-photo" id="photo{{photo.id}}" onclick="showModal('{{ photo.image.url }}','{{ photo.id }}')">
            {% endfor %}
        </div>
        {% else %}
            <div class="no-media-content">
                No photos
            </div>
        {% endif %}
    
<!-- Photo Modal-->
<div class="customized modal fade" id="photoModal"   data-bs-keyboard="false" tabindex="-1"  aria-hidden="true" >
    <div class="modal-dialog photo-modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-body justify-content-end modal-photo">
           
            <img id="modalImage" src="" alt="Photo" class="img-fluid">
        </div>
        <div class="modal-footer d-flex justify-content-center">
            <button type="button" class="btn btn-danger" id="delete_photo" data-dismiss="modal">Delete</button>
          </div>
      </div>
</div>

<!-- Delete confirmation Modal-->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" >
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-body">
            <p>Are you sure you want to delete this photo?</p>
        </div>
        <form id="confirmDeleteForm" method="post">
            {% csrf_token %}
            <div style="margin-bottom: 20px;">
                <button type="button" class="btn btn-secondary" id="close-deleteConfirmModal-btn">Close</button>
                <button type="submit" class="btn btn-danger" id="sure-delete-btn">Delete</button>
            </div> 
        </form>
      </div>
    </div>
  </div>

<script>
    function showModal(imageUrl,photoId){
        var modalImage = document.getElementById('modalImage');
        var deletePhotoBtn = document.getElementById('delete_photo');
        deletePhotoBtn.dataset.photoId = photoId; // Set the data attribute to the photoId
        modalImage.src = imageUrl;
        $('#photoModal').modal('show');
    }

    const deleteButton = document.getElementById('delete_photo');
    deleteButton.addEventListener('click', () => {
        $('#deleteConfirmModal').modal('show');
        /*
        const deleteForm = document.getElementById('deleteForm');
        deleteForm.action = '/delete_photo/5/';  // Update the form action with the appropriate photo ID
        $('#deleteModal').modal('show');  // Open the modal
        */
    });

    document.getElementById('close-deleteConfirmModal-btn').addEventListener('click', () => {
        
        $('#deleteConfirmModal').modal('hide');
    });
    document.getElementById('sure-delete-btn').addEventListener('click', () => {
        var photoId = document.getElementById('delete_photo').dataset.photoId;
        document.getElementById('confirmDeleteForm').action = `/delete_photo/${photoId}/`;

    });
</script>
{% endblock %}